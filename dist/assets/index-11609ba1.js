var R=Object.defineProperty;var M=(r,o,t)=>o in r?R(r,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[o]=t;var c=(r,o,t)=>(M(r,typeof o!="symbol"?o+"":o,t),t);import{r as j,R as S,j as e,S as m}from"./index-ed74f637.js";class C extends j.Component{constructor(t){super(t);c(this,"uplForm");c(this,"dropEl");c(this,"filEl");c(this,"getFile",t=>{const{upload:s}=this.props;if(s){const n=t.target,i=[];if("files"in n&&n.files.length>0)for(let l=0;l<n.files.length;l+=1)i.push(this.readFileContent(n.files[l]));Promise.all(i).then(l=>s(l,n.files))}});c(this,"dragLeave",()=>{this.dropEl.current&&this.dropEl.current.classList.remove("over")});c(this,"dropEnter",()=>{this.dropEl.current&&this.dropEl.current.classList.add("over")});c(this,"handleSubmit",t=>{t.preventDefault()});c(this,"btnClick",()=>{this.filEl&&this.filEl.current.click()});this.uplForm=S.createRef(),this.dropEl=S.createRef(),this.filEl=S.createRef()}readFileContent(t){const s=new FileReader,n=!1;return new Promise(i=>{s.onload=l=>{const a=l.target.result,h="",d={bstr:a,rABS:n,filename:t.name,form:this.uplForm,error:h};i(d)},s.readAsText(t,"utf8")})}renderInput({onChange:t,type:s,multiple:n}){const i="btn btn-primary";return e.jsx("div",{onDragEnter:this.dropEnter,ref:this.dropEl,onDragLeave:this.dragLeave,children:e.jsx("input",{placeholder:"Choose or Drop files",className:i,onChange:t,ref:this.filEl,type:"file",multiple:n,accept:s,tabIndex:-1,id:"files"})})}render(){const{label:t="",type:s,isSingle:n}=this.props;return e.jsx("div",{className:"btn-wrap",children:e.jsx("form",{onSubmit:this.handleSubmit,ref:this.uplForm,encType:"multipart/form-data",children:this.renderInput({onChange:this.getFile,type:s,multiple:!n})})})}}const L=/([0-9]+):([0-9]+):([0-9]+),([0-9]+)/g,I=/([0-9]+):([0-9]+):([0-9]+),([0-9]+)/,J=/\n[0-9]{1,6}\n/,U=/\n[0-9]{1,6}?\s\n/;function N(r){var n;const o=r.match(L);if(!o)return 0;const t=[];if(o.length){const i=new Date,l=(n=o[0].match(I))==null?void 0:n.map(Number);l&&i.setHours(Number(l[1]),l[2],l[3],l[4]),t.push(i)}const s=new Date;return s.setHours(0,0,0,0),t.push(s),t[0].getTime()-t[1].getTime()}let b=0;function A(r,o){const t=N(r);let s="";for(let n=b;n<o.length;n+=1){const i=N(o[n]);if(t-i<500){b=n,s=o[n];break}}return s}function B(r){b=0;const[o,t]=r;let s=J,n=o.bstr.split(s),i=t.bstr.split(s);n.length===1&&(s=U,n=o.bstr.split(s),i=t.bstr.split(s));const l=[];for(let h=0;h<n.length;h+=1)l.push(A(n[h],i));const a={bstr:l.join(`

`),filename:t.filename,fixed:!0};return{subs:[o,a],sepVariant:s}}function y(r){return r.replace(/<i>|<\/i>/gu,"")}const _=[{filename:"demoRU.srt",bstr:`184
00:11:37,691 --> 00:11:39,234
Какой размер файла?

185
00:11:40,276 --> 00:11:42,570
1,2 мегабайта? Не может быть.

186
00:11:43,571 --> 00:11:44,322
Ого, а качество не сниженное.

188
00:11:48,743 --> 00:11:50,276
Файл в половину меньше.

189
00:11:50,745 --> 00:11:52,539
И смотри, какая скорость.

190
00:11:54,666 --> 00:11:58,003
Охренеть. Как он
так быстро нашел?

191
00:11:59,045 --> 00:12:02,257
Он ищет по архивам?..

192
00:12:03,133 --> 00:12:04,342
Не может быть.
`},{filename:"demoEN.srt",bstr:`241
00:11:37,739 --> 00:11:39,782
What is this file size?

242
00:11:40,367 --> 00:11:42,451
1 .2 megabytes? No way.

243
00:11:43,620 --> 00:11:46,413
Wow, that doesn't sound at all downgraded.

244
00:11:48,708 --> 00:11:50,376
The file size is like, half.

245
00:11:50,752 --> 00:11:52,836
And look how fast this search is.

246
00:11:54,714 --> 00:11:57,925
Holy shit, how did it
find a match that fast?

247
00:11:59,010 --> 00:12:02,096
It's like it's searching compressed files?

248
00:12:03,139 --> 00:12:04,765
No way.
`}];function E(r){const o=document.getElementById("voice");if(!o)return;const t=speechSynthesis.getVoices(),s=document.createElement("option");s.value="",s.innerHTML="",o.appendChild(s),t.forEach(function(n,i){const l=document.createElement("option");l.value=n.name,l.innerHTML=n.name,n.name===r&&(l.selected=!0),o.appendChild(l)})}function $(r){const o=document.getElementById("msg");o&&("speechSynthesis"in window?o.innerHTML="Your browser <strong>supports</strong> speech synthesis.":(o.innerHTML='Sorry your browser <strong>does not support</strong> speech synthesis.<br>Try this in <a href="https://www.google.co.uk/intl/en/chrome/browser/canary.html">Chrome Canary</a>.',o.classList.add("not-supported"))),E(r),window.speechSynthesis.onvoiceschanged=function(t){E(r)}}const H={voice:""},O=({voice:r,rate:o,error:t,pitch:s,volume:n,togglePopup:i,voiceSettingSave:l})=>{const[a,h]=j.useState(H),d=p=>{const{name:u,value:x}=p.target;h({[u]:x})};j.useEffect(()=>{$(r)},[]);const f=p=>{if(!(!r&&!a.voice))return l(a),p.preventDefault(),!1};return e.jsx("div",{className:"lang-subs",children:e.jsx("div",{id:"filenames",className:"modal-window",children:e.jsx("div",{children:e.jsxs("form",{onSubmit:()=>!1,children:[e.jsx("a",{href:"",title:"Close",className:"modal-close",onClick:p=>i(p,!1),children:"Close"}),e.jsx("h1",{children:"Web Speech Synthesis Demo"}),e.jsx("div",{children:e.jsx("br",{})}),e.jsxs("div",{id:"page-wrapper",children:[e.jsx("p",{id:"msg"}),e.jsxs("div",{className:"option",children:[e.jsx("label",{htmlFor:"voice",children:"Voice"})," ",e.jsx("select",{required:!0,name:"voice",id:"voice",value:r||"",onChange:d})]}),e.jsxs("div",{className:"option",children:[e.jsx("label",{htmlFor:"volume",children:"Volume"}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",name:"volume",id:"volume",value:n,onChange:d})]}),e.jsxs("div",{className:"option",children:[e.jsx("label",{htmlFor:"rate",children:"Rate"}),e.jsx("input",{type:"range",min:"0.1",max:"10",step:"0.1",name:"rate",id:"rate",value:o,onChange:d})]}),e.jsxs("div",{className:"option",children:[e.jsx("label",{htmlFor:"pitch",children:"Pitch"}),e.jsx("input",{type:"range",min:"0",max:"2",step:"0.1",name:"pitch",id:"pitch",value:s,onChange:d})]}),t?e.jsx("div",{color:"red",children:t}):null,e.jsx("div",{children:e.jsx("button",{className:"btn",onClick:f,children:"Save"})})]}),e.jsx("div",{children:e.jsx("a",{href:"",title:"Close",className:"modal-close bottom",onClick:p=>i(p,!1),children:"Close"})})]})})})})},g="langBS_history",v="subs",V=({filenames:r,upload:o})=>{const[t,s]=j.useState(r||m.getJ(g)),n=(i,l=!1)=>()=>{let a;if(l){const d=t[i];d&&(a=d.subs)}let h=[...t.filter((d,f)=>f!==i)];m.setJ(g,h),l?o(a):s(h)};return!t||!t.length?null:e.jsx("div",{id:"filenames",className:"modal-window1",children:e.jsxs("div",{children:[e.jsx("h1",{children:"History"}),e.jsx("div",{children:e.jsx("div",{children:t&&t.map((i,l)=>e.jsxs("div",{children:[e.jsx("br",{}),i.subs.map((a,h)=>e.jsx("div",{children:e.jsxs("div",{children:[h+1," File ",`${a.filename}`]})},`${a.filename}${h}1`)),e.jsx("br",{}),e.jsxs("div",{children:[e.jsx("button",{className:"btn",onClick:n(l,!0),children:"restore"}),e.jsx("button",{className:"btn",onClick:n(l),children:"Delete"})]})]},`subs${l}1`))})})]})})},Y=({clear:r,filenames:o,togglePopup:t})=>{const s=m.getJ(g);return e.jsx("div",{id:"filenames",className:"modal-window",children:e.jsxs("div",{children:[e.jsx("a",{href:"",title:"Close",className:"modal-close",onClick:n=>t(n,!1),children:"Close"}),e.jsx("h1",{children:"Files"}),e.jsx("div",{children:e.jsxs("div",{children:[o.map((n,i)=>e.jsxs("div",{children:[i+1," File ",n]},n)),e.jsx("div",{children:e.jsx("button",{className:"btn",onClick:r,children:"Delete"})})]})}),s.length?e.jsx(V,{filenames:s}):null,e.jsx("div",{children:e.jsx("a",{href:"",title:"Close",className:"modal-close bottom",onClick:n=>t(n,!1),children:"Close"})})]})})},F="langscroll",P="srt",k="POPUP_DISCUSS",D="POPUP_SETTINGS",w="langbysubs_settings",W={SAME:"Files same, please upload different filename",EMPTY:"One of uploaded file has empty content, please upload another file"};function T(r){const{voice:o,rate:t=1,volume:s=1,pitch:n=1}=m.getJ(w)||{},i=new SpeechSynthesisUtterance;i.text=r,i.volume=parseFloat(String(s)),i.rate=parseFloat(String(t)),i.pitch=parseFloat(String(n)),o&&(i.voice=speechSynthesis.getVoices().filter(function(l){return l.name===o})[0]),window.speechSynthesis.speak(i)}class G extends j.Component{constructor(t){super(t);c(this,"sepVariant");c(this,"buttonPressTimer");c(this,"getSubs",(t=!0)=>{let s=m.getJ(v);return!s&&t&&(s=this.getDef()),s.sepVariant&&(s.sepVariant=new RegExp(s.sepVariant.replace(/\//g,""))),s});c(this,"getDef",()=>({subs:[],sepVariant:""}));c(this,"getItems",t=>{if(!t||t.length===0)return{items:[],filenames:[]};const s=[t[0].filename];let n=[];if(t[0]){const i=t[0].fixed?`

`:this.sepVariant;n=[t[0].bstr.split(i)]}if(t[1]){s.push(t[1].filename);const i=t[1].fixed?`

`:this.sepVariant;n.push(t[1].bstr.split(i))}return{items:n,filenames:s}});c(this,"upload",t=>{const{filenames:s}=this.state,n=s.length===2||t.length===2;if(s.length===1&&t[0].filename===s[0])return this.setState({error:"SAME"});let i=this.getDef();if(!n){const u=this.getSubs(!1);u&&(i=u)}const{setVariant:l}=i;let{subs:a=[]}=i,h="";l&&(this.sepVariant=l);for(let u=0;u<t.length;u+=1)t[u].bstr.trim()?a.push({bstr:t[u].bstr,filename:t[u].filename}):h="EMPTY";if(a.length){if(a.length===2){const{subs:u,sepVariant:x}=B(a);x&&(this.sepVariant=x),a=u,a[0].bstr=y(a[0].bstr),a[1].bstr=y(a[1].bstr)}m.setJ(v,{subs:a,sepVariant:`${this.sepVariant}`})}const{items:d,filenames:f}=this.getItems(a);let p=m.getJ(g)||[];if(p.length){const u=p.filter(x=>x.subs[0].filename!==a[0].filename);console.log(u,p,a),p.length!==u.length&&m.setJ(g,u)}this.setState({items:d,showStr:"",error:h,filenames:f})});c(this,"clear",()=>{const t=m.getJ(g)||[];t.push(m.getJ(v)),m.setJ(g,t),m.rm(v),this.setState({filenames:[],items:[],showPopupFiles:!1,showStr:"",error:""})});c(this,"replace",t=>{const{sepVariant:s,subs:n}=this.getSubs();let i=n;if(i.length<=1)return;i=[i[1],i[0]],m.setJ(v,{subs:i,sepVariant:`${s}`});const{items:l}=this.getItems(i);this.setState({items:l})});c(this,"show",t=>{const s=t.target.getAttribute("data-ind"),{items:n,isShown:i,ind:l}=this.state;let a=i;const[,h]=n;if(h[s]){a=s!==l||!a;let d="";a&&(d=h[s]),this.setState({showStr:d,ind:s,isShown:a})}});c(this,"handleButtonRelease",()=>{this.buttonPressTimer&&clearTimeout(this.buttonPressTimer)});c(this,"handleScroll",()=>{m.set(F,window.scrollY)});c(this,"getStr",t=>{const s=t.split(/>\s[0-9]+:[0-9]+:[0-9]+,[0-9]+/);return s[1]&&(t=s[1]),t});c(this,"renderRow",(t,s)=>{const{voice:n}=this.state;return t=this.getStr(t),e.jsx("div",{onTouchEnd:this.handleButtonRelease,onMouseDown:this.show,onMouseUp:this.handleButtonRelease,"data-ind":s,children:e.jsxs("div",{"data-ind":s,children:[t,e.jsx("span",{className:"tooltiptext",children:e.jsx("button",{onClick:n?()=>T(t):this.voiceSetting,className:"icon speech-voice"})})]})},`${t}${s}`)});c(this,"demo",t=>{t.preventDefault(),this.upload(_)});c(this,"togglePopup",(t,s=!0)=>{t.preventDefault(),this.setState({showPopupFiles:s,modal:""})});c(this,"toggleDiscuss",t=>{t.preventDefault(),this.setState({modal:k})});c(this,"closeModal",()=>{this.setState({modal:""})});c(this,"voiceSetting",t=>{t.preventDefault(),this.setState({modal:D})});c(this,"voiceSettingSave",t=>{const{voice:s,rate:n,pitch:i,volume:l}=t;if(this.state.voice===s||!s&&this.state.voice)return this.closeModal();m.setJ(w,{voice:s,rate:n,pitch:i,volume:l}),this.setState({modal:"",voice:s,rate:n,pitch:i,volume:l})});const{subs:s,sepVariant:n}=this.getSubs();this.sepVariant=n,this.buttonPressTimer=void 0;const{items:i=[],filenames:l=[]}=this.getItems(s),{voice:a,rate:h=1,volume:d=1,pitch:f=1}=m.getJ(w)||{};this.state={showStr:"",ind:"",isShown:-1,error:"",filenames:l,items:i,showPopupFiles:!1,modal:"",voice:a,rate:h,volume:d,pitch:f}}componentDidMount(){const t=m.get(F,!1);t&&window.scrollTo(0,t),window.addEventListener("scroll",this.handleScroll)}componentWillUnmount(){window.removeEventListener("scroll",this.handleScroll)}render(){const{items:t,showStr:s,error:n,filenames:i,showPopupFiles:l,modal:a,voice:h}=this.state,d=`folder${t.length?"-fill":""}`;return e.jsxs("div",{className:"lang-subs",children:[l?e.jsx(e.Fragment,{children:e.jsx(Y,{filenames:i,togglePopup:this.togglePopup,clear:this.clear})}):null,a===k?e.jsx("div",{id:"filenames",className:"modal-window",children:e.jsxs("div",{children:[e.jsx("a",{href:"",title:"Close",className:"modal-close",onClick:f=>this.togglePopup(f,!1),children:"Close"}),e.jsx("h1",{children:"Subs"}),e.jsxs("div",{children:["Upload your subs in channel:",e.jsx("a",{href:"tg://resolve?domain=langbysubs",children:" @langbysubs"})]}),e.jsx("div",{children:e.jsx("a",{href:"",title:"Close",className:"modal-close bottom",onClick:f=>this.togglePopup(f,!1),children:"Close"})})]})}):null,s?e.jsx("div",{className:"tooltip1",children:e.jsxs("span",{className:"tooltiptext",children:[this.getStr(s),e.jsx("button",{onClick:h?()=>T(this.getStr(s)):this.voiceSetting,className:"icon speech-voice"})]})}):null,e.jsx("div",{children:t.length===2?e.jsxs("div",{className:"buttons",children:[e.jsx("button",{className:`icon ${d}-icon`,onClick:this.togglePopup}),e.jsx("button",{className:"icon earth-search",onClick:this.toggleDiscuss}),e.jsx("button",{className:"icon speech-voice-setting",onClick:this.voiceSetting}),e.jsx("button",{className:"icon replace-icon",onClick:this.replace})]}):null}),e.jsxs("div",{className:"lang-items",children:[t.length?null:e.jsxs("div",{children:[e.jsx("div",{children:"Please upload two .srt files with different languages"}),e.jsx("p",{}),e.jsxs("div",{className:"flexible",children:[e.jsx(C,{type:P,upload:this.upload,label:"Add files"}),e.jsx("div",{className:"btn btn-ghost-success",children:"or"}),e.jsx("button",{className:"btn",onClick:this.demo,children:"TRY DEMO"})]}),e.jsx(V,{upload:this.upload})]}),t.length===1?e.jsxs("div",{className:"load-step",children:[n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"alert alert-danger",children:W[n]}),e.jsx("br",{})]}):null,e.jsxs("div",{children:["1 File ",i[0],e.jsx("span",{className:"green",children:" loaded"})]}),e.jsxs("div",{children:["2 File ",e.jsx("span",{className:"gray",children:"not loaded"})]}),e.jsx(C,{upload:this.upload,type:P,label:"Add second subtitles file",isSingle:!0}),e.jsx("br",{}),e.jsx("div",{children:e.jsx("button",{className:"btn",onClick:this.clear,children:"Delete all"})})]}):null,t.length===2?t[0].map((f,p)=>this.renderRow(f,p)):null]}),a===D?e.jsx(O,{closeModal:this.closeModal,voice:this.state.voice,rate:this.state.rate,pitch:this.state.pitch,volume:this.state.volume,error:this.state.error,togglePopup:this.togglePopup,voiceSettingSave:this.voiceSettingSave}):null]})}}const z=G,Q=()=>e.jsx(z,{});export{Q as default};
